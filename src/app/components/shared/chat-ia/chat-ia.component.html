<!-- DEBUG: Mostrar siempre para pruebas - Eliminar cuando esté en producción -->
<div *ngIf="true">
  <!-- Botón Flotante -->
  <button 
    class="chat-fab" 
    (click)="toggleChat()" 
    [class.active]="chatAbierto"
    *ngIf="!chatAbierto"
    title="Chat IA - Asistente Virtual"
  >
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
    </svg>
    <span class="fab-badge" *ngIf="mensajesNoLeidos > 0">{{ mensajesNoLeidos }}</span>
  </button>

  <!-- Ventana Flotante del Chat -->
  <div class="chat-floating-window" *ngIf="chatAbierto" [@slideIn]>
  <div class="chat-container">
    <!-- Header -->
    <div class="chat-header">
      <div class="header-content">
        <div class="header-left">
          <div class="bot-avatar">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
            </svg>
          </div>
          <div class="header-info">
            <h3>Asistente MediCitas</h3>
            <p *ngIf="cargando" class="typing">Escribiendo...</p>
          </div>
        </div>
        
        <div class="header-actions">
          <button class="btn-icon" (click)="limpiarHistorial()" title="Limpiar historial">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
          </button>
          
          <button class="btn-icon btn-close" (click)="toggleChat()" title="Cerrar">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      </div>
    </div>

  <!-- Messages Area -->
  <div class="messages-area" #messagesContainer>
    <div 
      *ngFor="let mensaje of mensajes" 
      [class]="'message ' + (mensaje.role === 'user' ? 'user-message' : 'assistant-message')"
    >
      <div class="message-avatar" *ngIf="mensaje.role === 'assistant'">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
        </svg>
      </div>
      
      <div class="message-content">
        <div class="message-text" [innerHTML]="mensaje.content | nl2br"></div>
        <div class="message-time">
          {{ mensaje.timestamp | date:'short' }}
        </div>
      </div>
      
      <div class="message-avatar" *ngIf="mensaje.role === 'user'">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
        </svg>
      </div>
    </div>
    
    <!-- Typing Indicator -->
    <div class="message assistant-message" *ngIf="cargando">
      <div class="message-avatar">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
        </svg>
      </div>
      <div class="message-content">
        <div class="typing-indicator">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
    </div>
  </div>

  <!-- Input Area -->
  <div class="input-area">
    <div class="input-container">
      <textarea 
        [(ngModel)]="mensajeUsuario"
        (keypress)="onKeyPress($event)"
        placeholder="Envía un mensaje a MediCitas..."
        class="message-input"
        rows="1"
        [disabled]="cargando"
      ></textarea>
      
      <button 
        class="btn-send" 
        (click)="enviarMensaje()"
        [disabled]="!mensajeUsuario.trim() || cargando"
      >
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z" />
        </svg>
      </button>
    </div>
  </div>
</div>
</div>