<div class="min-h-screen bg-gradient-to-br from-blue-50 via-white to-teal-50">
  <!-- Navbar Fixed -->
  <nav class="fixed top-0 left-0 right-0 z-50 bg-white/95 backdrop-blur-md shadow-md border-b border-gray-100">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-20">
        <div class="flex items-center space-x-12">
          <div class="flex items-center space-x-3 cursor-pointer" (click)="navigateTo('/admin/medicos')">
            <div class="w-10 h-10 bg-gradient-to-br from-blue-600 to-teal-500 rounded-xl flex items-center justify-center shadow-lg">
              <i class="pi pi-shield text-white text-xl"></i>
            </div>
            <div>
              <h1 class="text-xl font-bold bg-gradient-to-r from-blue-600 to-teal-600 bg-clip-text text-transparent">
                MediCitas Admin
              </h1>
              <p class="text-xs text-gray-500 -mt-1">Panel de Administraci√≥n</p>
            </div>
          </div>
          
          <div class="hidden md:flex items-center space-x-2">
            <button 
              (click)="selectModule('areas')"
              class="px-5 py-2.5 rounded-xl text-sm font-semibold text-gray-600 hover:bg-gray-100 transition-all duration-300">
              <i class="pi pi-th-large mr-2"></i>
              √Åreas
            </button>
            <button 
              (click)="selectModule('servicios')"
              class="px-5 py-2.5 rounded-xl text-sm font-semibold text-gray-600 hover:bg-gray-100 transition-all duration-300">
              <i class="pi pi-list mr-2"></i>
              Servicios
            </button>
            <button 
              (click)="selectModule('medicos')"
              class="px-5 py-2.5 rounded-xl text-sm font-semibold bg-gradient-to-r from-blue-600 to-teal-600 text-white shadow-lg shadow-blue-200 transition-all duration-300">
              <i class="pi pi-users mr-2"></i>
              M√©dicos
            </button>
          </div>
        </div>

        <div class="flex items-center space-x-3">
          <div class="hidden lg:block text-right mr-3">
            <p class="text-sm font-semibold text-gray-800">{{userName}}</p>
            <p class="text-xs text-gray-500">Administrador</p>
          </div>
          <button 
            class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-600 to-teal-500 flex items-center justify-center text-white font-bold shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
            {{ userName.charAt(0) || 'A' }}
          </button>
        </div>
      </div>
    </div>
  </nav>

  <div class="h-20"></div>
  <p-toast></p-toast>

  <main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    
    <div class="mb-8">
      <button 
        (click)="volver()"
        class="flex items-center text-gray-600 hover:text-blue-600 transition-colors duration-200 mb-4 group">
        <i class="pi pi-arrow-left mr-2 transform group-hover:-translate-x-1 transition-transform duration-200"></i>
        <span class="font-semibold">Volver a M√©dicos</span>
      </button>

      <div class="flex items-center space-x-4 mb-2">
        <div class="bg-gradient-to-br from-blue-600 to-teal-500 rounded-2xl p-4 shadow-lg">
          <i class="pi pi-user text-4xl text-white"></i>
        </div>
        <div>
          <h2 class="text-3xl font-bold text-gray-900">
            {{ modoEdicion ? 'Editar M√©dico' : 'Nuevo M√©dico' }}
          </h2>
          <p class="text-gray-600">
            {{ modoEdicion ? 'Actualiza la informaci√≥n del m√©dico' : 'Completa los datos del m√©dico' }}
          </p>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="cargando" class="bg-white rounded-2xl shadow-lg border border-gray-100 p-8">
      <div class="space-y-6 animate-pulse">
        <div *ngFor="let i of [1,2,3,4,5]">
          <div class="h-4 bg-gray-200 rounded w-1/4 mb-2"></div>
          <div class="h-12 bg-gray-200 rounded"></div>
        </div>
      </div>
    </div>

    <!-- Formulario -->
    <form *ngIf="!cargando" [formGroup]="medicoForm" (ngSubmit)="onSubmit()" class="animate-fadeIn">
      
      <!-- üìã SECCI√ìN 1: Informaci√≥n Personal -->
      <div class="form-section animate-slideIn">
        <div class="section-header">
          <div>
            <div class="flex items-center">
              <span class="section-number">1</span>
              <div>
                <h3 class="section-title">Informaci√≥n Personal</h3>
                <p class="section-subtitle">Datos b√°sicos del m√©dico</p>
              </div>
            </div>
          </div>
        </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Nombre -->
            <div class="form-field">
              <label for="nombre" class="form-label required">
                <i class="pi pi-user mr-2 text-blue-600"></i>Nombre(s)
              </label>
              <span class="p-input-icon-left w-full">
                <i class="pi pi-user text-gray-400"></i>
                <input 
                  pInputText 
                  id="nombre"
                  formControlName="nombre"
                  type="text"
                  placeholder="Ej: Juan Carlos"
                  [class]="isFieldInvalid('nombre') ? 'p-invalid' : ''"
                  class="w-full"
                  maxlength="100"
                  autocomplete="given-name" />
              </span>
              <div class="flex items-center justify-between mt-1">
                <small *ngIf="isFieldInvalid('nombre')" class="error-message">
                  <i class="pi pi-exclamation-circle"></i>{{ getErrorMessage('nombre') }}
                </small>
                <small class="text-xs text-gray-400">
                  {{ medicoForm.get('nombre')?.value?.length || 0 }}/100
                </small>
              </div>
            </div>

            <!-- Apellido Paterno -->
            <div class="form-field">
              <label for="apellidoPaterno" class="form-label required">
                <i class="pi pi-user mr-2 text-blue-600"></i>Apellido Paterno
              </label>
              <span class="p-input-icon-left w-full">
                <i class="pi pi-user text-gray-400"></i>
                <input 
                  pInputText 
                  id="apellidoPaterno"
                  formControlName="apellidoPaterno"
                  type="text"
                  placeholder="Ej: Garc√≠a"
                  [class]="isFieldInvalid('apellidoPaterno') ? 'p-invalid' : ''"
                  class="w-full"
                  maxlength="100"
                  autocomplete="family-name" />
              </span>
              <div class="flex items-center justify-between mt-1">
                <small *ngIf="isFieldInvalid('apellidoPaterno')" class="error-message">
                  <i class="pi pi-exclamation-circle"></i>{{ getErrorMessage('apellidoPaterno') }}
                </small>
                <small class="text-xs text-gray-400">
                  {{ medicoForm.get('apellidoPaterno')?.value?.length || 0 }}/100
                </small>
              </div>
            </div>

            <!-- Apellido Materno -->
            <div class="form-field">
              <label for="apellidoMaterno" class="form-label">
                <i class="pi pi-user mr-2 text-blue-600"></i>Apellido Materno
                <span class="text-xs text-gray-500 font-normal ml-2">(Opcional)</span>
              </label>
              <input 
                pInputText 
                id="apellidoMaterno"
                formControlName="apellidoMaterno"
                type="text"
                placeholder="Ej: L√≥pez"
                class="w-full"
                maxlength="100"
                autocomplete="additional-name" />
              <small class="text-xs text-gray-400 block mt-1 text-right">
                {{ medicoForm.get('apellidoMaterno')?.value?.length || 0 }}/100
              </small>
            </div>

            <!-- Sexo -->
            <div class="form-field">
              <label for="sexo" class="form-label required">
                <i class="pi pi-venus-mars mr-2 text-blue-600"></i>Sexo
              </label>
              <div class="relative">
                <select
                  id="sexo"
                  formControlName="sexo"
                  class="w-full rounded-xl border-2 border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-200 appearance-none pl-10 pr-10 py-3.5 font-medium bg-white"
                  [ngClass]="{'border-red-500 ring-red-200': isFieldInvalid('sexo')}">
                  <option value="" disabled selected>Selecciona el sexo</option>
                  <option *ngFor="let sexo of sexos" [value]="sexo.value">
                    {{ sexo.label }}
                  </option>
                </select>
                <i class="pi pi-venus-mars absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                <i class="pi pi-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"></i>
              </div>
              <small *ngIf="isFieldInvalid('sexo')" class="error-message">
                <i class="pi pi-exclamation-circle"></i>{{ getErrorMessage('sexo') }}
              </small>
            </div>

            <!-- Correo Electr√≥nico -->
            <div class="form-field md:col-span-2">
              <label for="correoElectronico" class="form-label required">
                <i class="pi pi-envelope mr-2 text-blue-600"></i>Correo Electr√≥nico
                <span class="text-xs text-gray-500 font-normal ml-2">(Se usar√° para iniciar sesi√≥n)</span>
              </label>
              <span class="p-input-icon-left w-full">
                <i class="pi pi-envelope text-gray-400"></i>
                <input 
                  pInputText 
                  id="correoElectronico"
                  formControlName="correoElectronico"
                  type="email"
                  placeholder="correo@ejemplo.com"
                  [class]="isFieldInvalid('correoElectronico') ? 'p-invalid' : ''"
                  class="w-full"
                  autocomplete="email"
                  maxlength="150" />
              </span>
              <small *ngIf="isFieldInvalid('correoElectronico')" class="error-message">
                <i class="pi pi-exclamation-circle"></i>{{ getErrorMessage('correoElectronico') }}
              </small>
              <small *ngIf="!isFieldInvalid('correoElectronico') && medicoForm.get('correoElectronico')?.value" 
                     class="flex items-center gap-1 text-green-600 text-xs mt-1">
                <i class="pi pi-check-circle"></i>
                Formato de correo v√°lido
              </small>
            </div>

            <!-- Direcci√≥n -->
            <div class="form-field md:col-span-2">
              <label for="direccion" class="form-label">
                <i class="pi pi-map-marker mr-2 text-blue-600"></i>Direcci√≥n Completa
                <span class="text-xs text-gray-500 font-normal ml-2">(Opcional)</span>
              </label>
              <textarea
                pInputTextarea
                id="direccion"
                formControlName="direccion"
                rows="3"
                placeholder="Calle, n√∫mero, colonia, ciudad, estado, c√≥digo postal..."
                class="w-full"
                maxlength="500">
              </textarea>
              <div class="flex items-center justify-between mt-1">
                <small class="text-xs text-gray-500">
                  <i class="pi pi-info-circle mr-1"></i>
                  Incluye todos los detalles para facilitar la ubicaci√≥n
                </small>
                <small class="text-xs text-gray-400">
                  {{ medicoForm.get('direccion')?.value?.length || 0 }}/500
                </small>
              </div>
            </div>

            <!-- Fecha de Nacimiento -->
            <div class="form-field">
              <label for="fechaNacimiento" class="form-label">
                <i class="pi pi-calendar mr-2 text-blue-600"></i>Fecha de Nacimiento
                <span class="text-xs text-gray-500 font-normal ml-2">(Opcional)</span>
              </label>
              <p-datepicker
                id="fechaNacimiento"
                formControlName="fechaNacimiento"
                iconDisplay="input"
                [maxDate]="maxDate"
                dateFormat="dd/mm/yy"
                placeholder="Selecciona la fecha"
                styleClass="w-full"
                inputStyleClass="w-full"
                [showIcon]="true">
              </p-datepicker>
              <small class="text-xs text-gray-500 block mt-1">
                <i class="pi pi-info-circle mr-1"></i>
                La fecha debe ser anterior a hoy
              </small>
            </div>

            <!-- Tel√©fono -->
            <div class="form-field">
              <label for="telefono" class="form-label">
                <i class="pi pi-phone mr-2 text-blue-600"></i>Tel√©fono de Contacto
                <span class="text-xs text-gray-500 font-normal ml-2">(Opcional)</span>
              </label>
              <span class="p-input-icon-left w-full">
                <input 
                  pInputText 
                  id="telefono"
                  formControlName="telefono"
                  type="tel"
                  placeholder="Ej: 477-123-4567"
                  class="w-full"
                  maxlength="20"
                  autocomplete="tel" />
              </span>
              <small class="text-xs text-gray-500 block mt-1">
                <i class="pi pi-info-circle mr-1"></i>
                Incluye lada (10 d√≠gitos recomendados)
              </small>
            </div>
          </div>
        </div>

        <!-- Secci√≥n 2: Informaci√≥n Profesional -->
        <div class="form-section animate-slideIn" style="animation-delay: 0.1s;">
          <div class="section-header">
            <div>
              <div class="flex items-center">
                <span class="section-number">2</span>
                <div>
                  <h3 class="section-title">Informaci√≥n Profesional</h3>
                  <p class="section-subtitle">Credenciales y servicios m√©dicos</p>
                </div>
              </div>
            </div>
          </div>

          <div class="space-y-6">
            <!-- C√©dula Profesional -->
            <div class="form-field">
              <label for="cedulaProfesional" class="form-label required">
                <i class="pi pi-id-card mr-2 text-teal-600"></i>C√©dula Profesional
              </label>
              <span class="p-input-icon-left w-full">
                <input 
                  pInputText 
                  id="cedulaProfesional"
                  formControlName="cedulaProfesional"
                  type="text"
                  placeholder="Ej: 12345678"
                  [class]="isFieldInvalid('cedulaProfesional') ? 'p-invalid' : ''"
                  class="w-full"
                  maxlength="50" />
              </span>
              <div class="flex items-center justify-between mt-1">
                <small *ngIf="isFieldInvalid('cedulaProfesional')" class="error-message">
                  <i class="pi pi-exclamation-circle"></i>{{ getErrorMessage('cedulaProfesional') }}
                </small>
                <small *ngIf="!isFieldInvalid('cedulaProfesional') && medicoForm.get('cedulaProfesional')?.value" 
                       class="flex items-center gap-1 text-green-600 text-xs">
                  <i class="pi pi-check-circle"></i>
                  C√©dula registrada
                </small>
                <small class="text-xs text-gray-400 ml-auto">
                  {{ medicoForm.get('cedulaProfesional')?.value?.length || 0 }}/50
                </small>
              </div>
              <small class="text-xs text-gray-500 block mt-1">
                <i class="pi pi-shield mr-1"></i>
                N√∫mero de c√©dula profesional otorgado por la SEP
              </small>
            </div>

            <!-- Servicios Asignados -->
            <div class="form-field">
              <div class="mb-4">
                <label class="form-label required">
                  <i class="pi pi-briefcase mr-2 text-teal-600"></i>Servicios M√©dicos Asignados
                </label>
                <div class="info-badge">
                  <i class="pi pi-info-circle"></i>
                  <span>Puede asignar m√∫ltiples especialidades o servicios al m√©dico</span>
                </div>
              </div>

              <div formArrayName="servicios" class="space-y-3">
                <div *ngFor="let servicioGroup of serviciosArray.controls; let i = index" 
                     [formGroupName]="i" 
                     class="servicio-item animate-scaleIn">
                  <span class="servicio-number">{{ i + 1 }}</span>
                  
                  <div class="flex items-start gap-3 pt-2">
                    <div class="flex-1">
                      <div class="relative">
                        <select
                          formControlName="idServicio"
                          class="w-full rounded-xl border-2 border-gray-200 focus:border-teal-500 focus:ring-2 focus:ring-teal-200 transition-all duration-200 appearance-none pl-12 pr-10 py-3.5 font-medium bg-white"
                          [ngClass]="{'border-red-500 ring-red-200': servicioGroup.get('idServicio')?.invalid && (servicioGroup.get('idServicio')?.dirty || servicioGroup.get('idServicio')?.touched)}">
                          <option value="" disabled selected>Selecciona un servicio m√©dico</option>
                          <option *ngFor="let serv of servicios" [value]="serv.id">
                            {{ serv.nombreServicio }}
                          </option>
                        </select>
                        <i class="pi pi-briefcase absolute left-4 top-1/2 -translate-y-1/2 text-teal-600 text-lg"></i>
                        <i class="pi pi-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                      </div>
                      <small *ngIf="servicioGroup.get('idServicio')?.invalid && (servicioGroup.get('idServicio')?.dirty || servicioGroup.get('idServicio')?.touched)" 
                             class="error-message">
                        <i class="pi pi-exclamation-circle"></i>Debe seleccionar un servicio
                      </small>
                    </div>
                    
                    <button
                      *ngIf="serviciosArray.length > 1"
                      type="button"
                      (click)="removeServicio(i)"
                      class="btn-remove-servicio">
                      <i class="pi pi-trash"></i>
                      Eliminar
                    </button>
                  </div>
                </div>
              </div>

              <button
                type="button"
                (click)="agregarOtroServicio()"
                class="btn-add-servicio mt-4">
                <i class="pi pi-plus-circle text-lg"></i>
                Agregar otro servicio
              </button>
            </div>
          </div>
        </div>

        <!-- Botones de Acci√≥n -->
        <div class="form-section animate-slideIn" style="animation-delay: 0.2s;">
          <div class="action-buttons">
            <button
              type="button"
              (click)="volver()"
              [disabled]="guardando"
              pButton
              label="Cancelar"
              icon="pi pi-times"
              class="p-button-secondary flex-1">
            </button>
            
            <button
              type="submit"
              [disabled]="medicoForm.invalid || guardando"
              pButton
              [loading]="guardando"
              [label]="guardando 
                ? (modoEdicion ? 'Actualizando...' : 'Guardando...') 
                : (modoEdicion ? 'Actualizar M√©dico' : 'Crear M√©dico')"
              [icon]="modoEdicion ? 'pi pi-check' : 'pi pi-plus'"
              class="p-button-success flex-1">
            </button>
          </div>
        </div>

        <!-- Informaci√≥n adicional -->
        <div class="form-section animate-slideIn" style="animation-delay: 0.3s; background: linear-gradient(135deg, #dbeafe, #d1fae5); border: 2px solid #93c5fd;">
          <div class="flex items-start gap-4">
            <div class="w-12 h-12 bg-gradient-to-br from-blue-600 to-teal-500 rounded-xl flex items-center justify-center flex-shrink-0 shadow-lg">
              <i class="pi pi-info-circle text-white text-2xl"></i>
            </div>
            <div class="flex-1">
              <h4 class="font-bold text-gray-900 text-lg mb-3 flex items-center">
                üí° Informaci√≥n Importante
              </h4>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                <div class="flex items-start gap-2 bg-white/60 backdrop-blur-sm rounded-lg p-3">
                  <i class="pi pi-check-circle text-green-600 text-lg mt-0.5 flex-shrink-0"></i>
                  <span class="text-sm text-gray-700 font-medium">Rol de m√©dico asignado autom√°ticamente</span>
                </div>
                <div class="flex items-start gap-2 bg-white/60 backdrop-blur-sm rounded-lg p-3">
                  <i class="pi pi-check-circle text-green-600 text-lg mt-0.5 flex-shrink-0"></i>
                  <span class="text-sm text-gray-700 font-medium">M√∫ltiples servicios por m√©dico permitidos</span>
                </div>
                <div class="flex items-start gap-2 bg-white/60 backdrop-blur-sm rounded-lg p-3">
                  <i class="pi pi-check-circle text-green-600 text-lg mt-0.5 flex-shrink-0"></i>
                  <span class="text-sm text-gray-700 font-medium">C√©dula √∫nica para todos los servicios</span>
                </div>
                <div class="flex items-start gap-2 bg-white/60 backdrop-blur-sm rounded-lg p-3">
                  <i class="pi pi-check-circle text-green-600 text-lg mt-0.5 flex-shrink-0"></i>
                  <span class="text-sm text-gray-700 font-medium">Contrase√±a temporal enviada por correo</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </form>
    </main>
  </div>